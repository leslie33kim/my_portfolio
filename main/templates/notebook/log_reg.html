<div  class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>L2-regularized logistic regression for binary or multiclass classification; trains a model (on <code>train.txt</code>), optimizes L2 regularization strength on <code>dev.txt</code>, and evaluates performance on <code>test.txt</code>.  Reports test accuracy with 95% confidence intervals and prints out the strongest coefficients for each class.</p>

</div>
</div>
</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#from google.colab import drive</span>
<span class="c1">#drive.mount(&#39;/content/drive&#39;)</span>
<span class="c1">#%cd drive/My Drive/INFO 159</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python -m nltk.downloader punkt
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>/opt/homebrew/Caskroom/miniforge/base/lib/python3.9/runpy.py:127: RuntimeWarning: &#39;nltk.downloader&#39; found in sys.modules after import of package &#39;nltk&#39;, but prior to execution of &#39;nltk.downloader&#39;; this may result in unpredictable behaviour
  warn(RuntimeWarning(msg))
[nltk_data] Downloading package punkt to /Users/lesliekim/nltk_data...
[nltk_data]   Unzipping tokenizers/punkt.zip.
</pre>
</div>
</div>

</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">idd</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

            <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Classifier</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_method</span><span class="p">,</span> <span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span> <span class="n">devX</span><span class="p">,</span> <span class="n">devY</span><span class="p">,</span> <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_vocab</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_method</span> <span class="o">=</span> <span class="n">feature_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_feature_count</span><span class="o">=</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trainY</span><span class="o">=</span><span class="n">trainY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devY</span><span class="o">=</span><span class="n">devY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testY</span><span class="o">=</span><span class="n">testY</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">trainX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">trainX</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">devX</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">testX</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Featurize entire dataset</span>
    <span class="k">def</span> <span class="nf">featurize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">featurized_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_method</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="n">featurized_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feats</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">featurized_data</span>

    <span class="c1"># Read dataset and returned featurized representation as sparse matrix + label array</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_data</span><span class="p">,</span> <span class="n">training</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">featurize</span><span class="p">(</span><span class="n">X_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">feature_doc_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">feats</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">:</span>
                    <span class="n">feature_doc_count</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span><span class="o">+=</span> <span class="mi">1</span>

            <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">feature_doc_count</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature_doc_count</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_feature_count</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">feature_vocab</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span> <span class="o">=</span> <span class="n">fid</span>
                    <span class="n">fid</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">F</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_vocab</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">dok_matrix</span><span class="p">((</span><span class="n">D</span><span class="p">,</span> <span class="n">F</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feats</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_vocab</span><span class="p">:</span>
                    <span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_vocab</span><span class="p">[</span><span class="n">feat</span><span class="p">]]</span> <span class="o">=</span> <span class="n">feats</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">X</span>


    <span class="c1"># Train model and evaluate on held-out data</span>
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">F</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainX</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">best_dev_accuracy</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">best_model</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">for</span> <span class="n">C</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainY</span><span class="p">)</span>
            <span class="n">training_accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainY</span><span class="p">)</span>
            <span class="n">development_accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">devY</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">development_accuracy</span> <span class="o">&gt;</span> <span class="n">best_dev_accuracy</span><span class="p">:</span>
                <span class="n">best_dev_accuracy</span><span class="o">=</span><span class="n">development_accuracy</span>
                <span class="n">best_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span>

<span class="c1">#             print(&quot;C: %s, Train accuracy: %.3f, Dev accuracy: %.3f&quot; % (C, training_accuracy, development_accuracy))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">=</span><span class="n">best_model</span>
        

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">testY</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">printWeights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>

        <span class="n">reverse_vocab</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_vocab</span><span class="p">:</span>
            <span class="n">reverse_vocab</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_vocab</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">=</span><span class="n">k</span>

        <span class="c1"># binary</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
              <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

              <span class="n">cat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
              <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">reverse_vocab</span><span class="p">,</span> <span class="n">weights</span><span class="p">),</span> <span class="n">key</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))))[:</span><span class="n">n</span><span class="p">]:</span>
                  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">feature</span><span class="p">))</span>
              <span class="nb">print</span><span class="p">()</span>

              <span class="n">cat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
              <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">reverse_vocab</span><span class="p">,</span> <span class="n">weights</span><span class="p">),</span> <span class="n">key</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">)))[:</span><span class="n">n</span><span class="p">]:</span>
                  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">feature</span><span class="p">))</span>
              <span class="nb">print</span><span class="p">()</span>

        <span class="c1"># multiclass</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">classes_</span><span class="p">):</span>

              <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_reg</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

              <span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">reverse_vocab</span><span class="p">,</span> <span class="n">weights</span><span class="p">),</span> <span class="n">key</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))))[:</span><span class="n">n</span><span class="p">]:</span>
                  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%.3f</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">feature</span><span class="p">))</span>
              <span class="nb">print</span><span class="p">()</span>

            
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">nltk</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;wordnet&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">wordnet</span> <span class="k">as</span> <span class="n">wn</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package wordnet to
[nltk_data]     /Users/lesliekim/nltk_data...
</pre>
</div>
</div>

</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nltk.stem.porter</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">stemmer</span> <span class="o">=</span> <span class="n">PorterStemmer</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">action_verbs</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">bigrams</span><span class="p">,</span> <span class="n">trigrams</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">stemmer</span><span class="p">):</span>
  <span class="n">action_verbs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;must&#39;</span><span class="p">,</span> <span class="s1">&#39;shall&#39;</span><span class="p">,</span> <span class="s1">&#39;will&#39;</span><span class="p">,</span> <span class="s1">&#39;shall&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;can&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="s1">&#39;terminate&#39;</span><span class="p">,</span> <span class="s1">&#39;reasonable&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;good&#39;</span><span class="p">,</span> <span class="s1">&#39;faith&#39;</span><span class="p">,</span> <span class="s1">&#39;audit&#39;</span><span class="p">,</span> <span class="s1">&#39;examine&#39;</span><span class="p">,</span> <span class="s1">&#39;first&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="s1">&#39;own&#39;</span><span class="p">,</span> <span class="s1">&#39;expense&#39;</span><span class="p">,</span> <span class="s1">&#39;negotiate&#39;</span><span class="p">,</span> <span class="s1">&#39;valuable&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;commercially&#39;</span><span class="p">,</span> <span class="s1">&#39;irrevocable&#39;</span><span class="p">,</span> <span class="s1">&#39;perpetual&#39;</span><span class="p">,</span> <span class="s1">&#39;neither&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;liable&#39;</span><span class="p">,</span> <span class="s1">&#39;indirect&#39;</span><span class="p">,</span> <span class="s1">&#39;damage&#39;</span><span class="p">,</span> <span class="s1">&#39;waive&#39;</span><span class="p">,</span> <span class="s1">&#39;suit&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;claim&#39;</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="s1">&#39;demand&#39;</span><span class="p">,</span> <span class="s1">&#39;liability&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;cost&#39;</span><span class="p">,</span> <span class="s1">&#39;expense&#39;</span><span class="p">,</span> <span class="s1">&#39;written&#39;</span><span class="p">,</span> <span class="s1">&#39;notice&#39;</span><span class="p">,</span> <span class="s1">&#39;immediately&#39;</span>
                  <span class="s1">&#39;written&#39;</span><span class="p">,</span> <span class="s1">&#39;notice&#39;</span><span class="p">,</span> <span class="s1">&#39;agreement&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="s1">&#39;amended&#39;</span><span class="p">,</span> <span class="s1">&#39;without&#39;</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">,</span> <span class="s1">&#39;fee&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;not&#39;</span><span class="p">,</span> <span class="s1">&#39;obligation&#39;</span><span class="p">,</span> <span class="s1">&#39;request&#39;</span><span class="p">,</span> <span class="s1">&#39;notice&#39;</span><span class="p">,</span> <span class="s1">&#39;inspect&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;inspection&#39;</span><span class="p">,</span> <span class="s1">&#39;auditing&#39;</span><span class="p">,</span> <span class="s1">&#39;responsible&#39;</span><span class="p">,</span> <span class="s1">&#39;partially&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;partial&#39;</span><span class="p">,</span> <span class="s1">&#39;only&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;exception&#39;</span><span class="p">,</span> <span class="s1">&#39;pay&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;exceed&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;worldwide&#39;</span><span class="p">,</span> <span class="s1">&#39;sublicensable&#39;</span><span class="p">,</span> <span class="s1">&#39;royalty&#39;</span><span class="p">,</span> <span class="s1">&#39;free&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;non-exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;license&#39;</span><span class="p">,</span> <span class="s1">&#39;independent&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;directly&#39;</span><span class="p">,</span> <span class="s1">&#39;indirectly&#39;</span><span class="p">,</span> <span class="s1">&#39;not&#39;</span><span class="p">,</span> <span class="s1">&#39;contain&#39;</span><span class="p">,</span> <span class="s1">&#39;limitation&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;permitted&#39;</span><span class="p">,</span> <span class="s1">&#39;prohibited&#39;</span><span class="p">,</span> <span class="s1">&#39;consent&#39;</span><span class="p">,</span> <span class="s1">&#39;circumstance&#39;</span><span class="p">,</span> <span class="s1">&#39;restriction&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;profit&#39;</span><span class="p">,</span> <span class="s1">&#39;entitled&#39;</span><span class="p">,</span> <span class="s1">&#39;recover&#39;</span><span class="p">,</span> <span class="s1">&#39;limited&#39;</span><span class="p">,</span> <span class="s1">&#39;seek&#39;</span><span class="p">,</span> <span class="s1">&#39;breach&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;omission&#39;</span><span class="p">,</span> <span class="s1">&#39;penalty&#39;</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">,</span> <span class="s1">&#39;non-transferable&#39;</span><span class="p">,</span> <span class="s1">&#39;cancellation&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;transferable&#39;</span><span class="p">,</span> <span class="s1">&#39;limited&#39;</span><span class="p">,</span> <span class="s1">&#39;consent&#39;</span><span class="p">,</span> <span class="s1">&#39;notify&#39;</span><span class="p">,</span> <span class="s1">&#39;compliance&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
                  <span class="p">]</span>
  <span class="n">synonyms</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">verb</span> <span class="ow">in</span> <span class="n">action_verbs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">syn</span> <span class="ow">in</span> <span class="n">wn</span><span class="o">.</span><span class="n">synsets</span><span class="p">(</span><span class="n">verb</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">syn</span><span class="o">.</span><span class="n">lemmas</span><span class="p">():</span>
          <span class="n">synonyms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
  <span class="n">action_verbs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">action_verbs</span> <span class="o">+</span> <span class="n">synonyms</span><span class="p">))</span>
  <span class="n">action_verbs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">verb</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">verb</span> <span class="ow">in</span> <span class="n">action_verbs</span><span class="p">])</span>

  <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">action_verbs</span><span class="p">:</span>
      <span class="n">feats</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


  <span class="n">bigrams_list</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">(</span><span class="s1">&#39;only&#39;</span><span class="p">,</span> <span class="s1">&#39;responsible&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;partially&#39;</span><span class="p">,</span> <span class="s1">&#39;permitted&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;conditionally&#39;</span><span class="p">,</span> <span class="s1">&#39;responsible&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;with&#39;</span><span class="p">,</span> <span class="s1">&#39;exception&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;aggregate&#39;</span><span class="p">,</span> <span class="s1">&#39;liability&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;exclusive&#39;</span><span class="p">,</span> <span class="s1">&#39;access&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;transferable&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;sublicensable&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;restrictions&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="s1">&#39;notice&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;written&#39;</span><span class="p">,</span> <span class="s1">&#39;notice&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="s1">&#39;consent&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;damages&#39;</span><span class="p">,</span> <span class="s1">&#39;incurred&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;liability&#39;</span><span class="p">,</span> <span class="s1">&#39;cap&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;not&#39;</span><span class="p">,</span> <span class="s1">&#39;permitted&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;independent&#39;</span><span class="p">,</span> <span class="s1">&#39;certified&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;cancellation&#39;</span><span class="p">,</span> <span class="s1">&#39;fee&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;good&#39;</span><span class="p">,</span> <span class="s1">&#39;faith&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;own&#39;</span><span class="p">,</span> <span class="s1">&#39;expense&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;terminate&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;liability&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;own&#39;</span><span class="p">,</span> <span class="s1">&#39;expense&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;obligation&#39;</span><span class="p">)</span>
  <span class="p">]</span>
  <span class="n">bigrams_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">pairs</span> <span class="ow">in</span> <span class="n">bigrams_list</span><span class="p">]</span>
  
  <span class="k">for</span> <span class="n">bi</span> <span class="ow">in</span> <span class="n">bigrams</span><span class="p">:</span>
    <span class="n">bi</span> <span class="o">=</span> <span class="p">(</span><span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">bi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">bi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">bi</span> <span class="ow">in</span> <span class="n">bigrams_list</span><span class="p">:</span>
      <span class="n">feats</span><span class="p">[</span><span class="n">bi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">bi</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>


  <span class="n">trigrams_list</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">(</span><span class="s1">&#39;unless&#39;</span><span class="p">,</span> <span class="s1">&#39;otherwise&#39;</span><span class="p">,</span> <span class="s1">&#39;agreed&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;under&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;circumstances&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;at&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;independent&#39;</span><span class="p">,</span> <span class="s1">&#39;3rd&#39;</span><span class="p">,</span> <span class="s1">&#39;party&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;independent&#39;</span><span class="p">,</span> <span class="s1">&#39;third&#39;</span><span class="p">,</span> <span class="s1">&#39;party&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;optional&#39;</span><span class="p">,</span> <span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
  <span class="p">]</span>
  <span class="n">trigrams_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">triplet</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">triplet</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">triplet</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="k">for</span> <span class="n">triplet</span> <span class="ow">in</span> <span class="n">trigrams_list</span><span class="p">]</span>

  <span class="k">for</span> <span class="n">tri</span> <span class="ow">in</span> <span class="n">trigrams</span><span class="p">:</span>
    <span class="n">tri</span> <span class="o">=</span> <span class="p">(</span><span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span>  <span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
    <span class="k">if</span> <span class="n">tri</span> <span class="ow">in</span> <span class="n">trigrams_list</span><span class="p">:</span>
      <span class="n">feats</span><span class="p">[</span><span class="n">tri</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">tri</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">tri</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">feats</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">penalty_fee</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">bigrams</span><span class="p">,</span> <span class="n">trigrams</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">stemmer</span><span class="p">):</span>
  <span class="n">penalty</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;penalty&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;repercussion&quot;</span><span class="p">,</span> <span class="s2">&quot;consequence&quot;</span><span class="p">,</span> <span class="s2">&quot;breach&quot;</span><span class="p">,</span> <span class="s2">&quot;prohibited&quot;</span><span class="p">,</span> <span class="s2">&quot;disallow&quot;</span><span class="p">,</span> <span class="s2">&quot;concurrent&quot;</span><span class="p">,</span>
           <span class="s2">&quot;entitle&quot;</span><span class="p">,</span> <span class="s2">&quot;breach&quot;</span><span class="p">,</span> <span class="s2">&quot;non-compliance&quot;</span><span class="p">]</span>
  <span class="n">audit</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;audit&quot;</span><span class="p">,</span> <span class="s2">&quot;prior notice&quot;</span><span class="p">,</span> <span class="s2">&quot;written notice&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\d+ day notice&quot;</span><span class="p">]</span>
  <span class="n">synonyms</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">penalty</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">syn</span> <span class="ow">in</span> <span class="n">wn</span><span class="o">.</span><span class="n">synsets</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">syn</span><span class="o">.</span><span class="n">lemmas</span><span class="p">():</span>
          <span class="n">synonyms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
  <span class="n">updated_pen</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">penalty</span> <span class="o">+</span> <span class="n">synonyms</span> <span class="o">+</span> <span class="n">audit</span><span class="p">))</span>
  <span class="n">updated_pen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">penalty</span><span class="p">])</span>

  <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">word</span> <span class="o">=</span> <span class="n">stemmer</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">updated_pen</span><span class="p">:</span>
      <span class="n">feats</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">feats</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">binary_bow_featurize</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">feats</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">bigrams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">bigrams</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
    <span class="n">trigrams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nltk</span><span class="o">.</span><span class="n">trigrams</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
    <span class="c1">#lemmatizer = nltk.stem.WordNetLemmatizer()</span>
    <span class="n">stemmer</span> <span class="o">=</span> <span class="n">PorterStemmer</span><span class="p">()</span>

    <span class="n">feats</span> <span class="o">=</span> <span class="n">action_verbs</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">bigrams</span><span class="p">,</span> <span class="n">trigrams</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">stemmer</span><span class="p">)</span>
    <span class="n">feats</span> <span class="o">=</span> <span class="n">penalty_fee</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">bigrams</span><span class="p">,</span> <span class="n">trigrams</span><span class="p">,</span> <span class="n">feats</span><span class="p">,</span> <span class="n">stemmer</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">feats</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">confidence_intervals</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">significance_level</span><span class="p">):</span>
    <span class="n">critical_value</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">significance_level</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">z_alpha</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">critical_value</span><span class="p">)</span>
    <span class="n">se</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">accuracy</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">accuracy</span><span class="p">))</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">accuracy</span><span class="o">-</span><span class="p">(</span><span class="n">se</span><span class="o">*</span><span class="n">z_alpha</span><span class="p">),</span> <span class="n">accuracy</span><span class="o">+</span><span class="p">(</span><span class="n">se</span><span class="o">*</span><span class="n">z_alpha</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">trainingFile</span><span class="p">,</span> <span class="n">devFile</span><span class="p">,</span> <span class="n">testFile</span><span class="p">):</span>
    <span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="o">=</span><span class="n">load_data</span><span class="p">(</span><span class="n">trainingFile</span><span class="p">)</span>
    <span class="n">devX</span><span class="p">,</span> <span class="n">devY</span><span class="o">=</span><span class="n">load_data</span><span class="p">(</span><span class="n">devFile</span><span class="p">)</span>
    <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="o">=</span><span class="n">load_data</span><span class="p">(</span><span class="n">testFile</span><span class="p">)</span>
    
    <span class="n">simple_classifier</span> <span class="o">=</span> <span class="n">Classifier</span><span class="p">(</span><span class="n">binary_bow_featurize</span><span class="p">,</span> <span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span> <span class="n">devX</span><span class="p">,</span> <span class="n">devY</span><span class="p">,</span> <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="p">)</span>
    <span class="n">simple_classifier</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">accuracy</span><span class="o">=</span><span class="n">simple_classifier</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
    
    <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">confidence_intervals</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">testY</span><span class="p">),</span> <span class="o">.</span><span class="mi">95</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test accuracy for best dev model: </span><span class="si">%.3f</span><span class="s2">, 95</span><span class="si">%%</span><span class="s2"> CIs: [</span><span class="si">%.3f</span><span class="s2"> </span><span class="si">%.3f</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">))</span>

    <span class="n">simple_classifier</span><span class="o">.</span><span class="n">printWeights</span><span class="p">()</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">trainingFile</span> <span class="o">=</span> <span class="s2">&quot;train.txt&quot;</span>
<span class="n">devFile</span> <span class="o">=</span> <span class="s2">&quot;dev.txt&quot;</span>
<span class="n">testFile</span> <span class="o">=</span> <span class="s2">&quot;test.txt&quot;</span>
    
<span class="n">run</span><span class="p">(</span><span class="n">trainingFile</span><span class="p">,</span> <span class="n">devFile</span><span class="p">,</span> <span class="n">testFile</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Test accuracy for best dev model: 0.624, 95% CIs: [0.529 0.718]

DP	0.507	non-exclus
DP	0.434	exceed
DP	0.378	permit
DP	0.337	sole
DP	0.308	non-transfer
DP	0.238	except
DP	0.228	liabil
DP	0.224	worldwid
DP	0.221	royalti
DP	0.220	licens

MP	0.588	exclus
MP	0.284	must
MP	0.280	term
MP	0.220	not
MP	0.205	ani
MP	0.204	take
MP	0.196	exclus_right
MP	0.189	pay
MP	0.183	expir
MP	0.173	case

NP	0.324	negoti
NP	0.289	liabl
NP	0.284	first
NP	0.267	may
NP	0.262	special
NP	0.231	have
NP	0.212	commerci
NP	0.191	set
NP	0.190	advis
NP	0.161	amend

</pre>
</div>
</div>

</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
<div  class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>


